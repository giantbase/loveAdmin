"use strict";(self["webpackChunklove_admin"]=self["webpackChunklove_admin"]||[]).push([[671],{5671:function(e,t,a){a.r(t),a.d(t,{default:function(){return d}});var l=function(){var e=this,t=e._self._c;return t("el-row",[t("el-col",{attrs:{span:24}},[t("div",{staticClass:"search"},[t("el-button",{attrs:{type:"danger",disabled:e.disabled},on:{click:function(t){return e.delSelection()}}},[e._v(" 批量删除 ")]),t("el-button",{attrs:{type:"primary"},on:{click:e.openAddMember}},[e._v("添加")]),t("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入内容"},model:{value:e.searchName,callback:function(t){e.searchName=t},expression:"searchName"}},[t("el-button",{staticClass:"searchInput",attrs:{slot:"append",icon:"el-icon-search"},slot:"append"},[e._v("搜索")])],1)],1),t("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"",border:""},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"105",align:"center"}}),t("el-table-column",{attrs:{label:"序号",type:"index",width:"120",align:"center"}}),t("el-table-column",{attrs:{label:"用户名"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("i",[e._v(e._s(a.row.username))])]}}])}),t("el-table-column",{attrs:{label:"角色列表",width:"500"},scopedSlots:e._u([{key:"default",fn:function(a){return e._l(a.row.roles,(function(a){return t("i",{key:a.id,staticClass:"afterComma"},[e._v(e._s(a.realname))])}))}}])}),t("el-table-column",{attrs:{label:"操作",width:"300",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.openAlterMember(a.$index,a.row)}}},[e._v("分配角色")]),t("el-button",{attrs:{type:"danger",size:"small"},nativeOn:{click:function(t){return t.preventDefault(),e.deleteRow(a.$index,a.row)}}},[e._v(" 删除 ")])]}}])})],1),t("el-dialog",{attrs:{title:"添加用户",visible:e.dialogAddFormVisible},on:{"update:visible":function(t){e.dialogAddFormVisible=t}}},[t("el-form",{ref:"addForm",attrs:{model:e.addForm,rules:e.rules}},[t("el-form-item",{attrs:{label:"用户名：","label-width":"100px",prop:"username"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.addForm.username,callback:function(t){e.$set(e.addForm,"username",t)},expression:"addForm.username"}})],1),t("el-form-item",{attrs:{label:"电话：","label-width":"100px",prop:"phone"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.addForm.phone,callback:function(t){e.$set(e.addForm,"phone",t)},expression:"addForm.phone"}})],1),t("el-form-item",{attrs:{label:"密码：","label-width":"100px",prop:"password"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.addForm.password,callback:function(t){e.$set(e.addForm,"password",t)},expression:"addForm.password"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogAddFormVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addMember("addForm")}}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"角色分配",visible:e.dialogAddRoleFormVisible},on:{"update:visible":function(t){e.dialogAddRoleFormVisible=t}}},[t("el-form",[t("el-form-item",{attrs:{label:"用户名：","label-width":"100px"}},[t("el-input",{attrs:{autocomplete:"off",disabled:""},model:{value:e.dialogMemberData.username,callback:function(t){e.$set(e.dialogMemberData,"username",t)},expression:"dialogMemberData.username"}})],1),t("el-form-item",{attrs:{label:"角色列表：","label-width":"100px"}},[t("el-checkbox-group",{model:{value:e.roles,callback:function(t){e.roles=t},expression:"roles"}},e._l(e.roleData,(function(a){return t("el-checkbox",{key:a.id,attrs:{label:a.realname}},[e._v(e._s(a.realname))])})),1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogAddRoleFormVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addRole()}}},[e._v("确 定")])],1)],1),t("el-pagination",{staticStyle:{"margin-top":"20px"},attrs:{background:"","current-page":e.currentPage,"page-size":e.size,"pager-count":5,layout:"prev, pager, next, jumper, total",total:e.total},on:{"current-change":e.getAllMember}})],1)],1)},s=[],r=(a(7658),{name:"User",data(){return{rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:5,message:"长度在 3 到 5 个字符",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{min:11,max:12,message:"请输入正确手机号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码最少 6 位",trigger:"blur"}]},searchName:"",deleteData:[],disabled:!0,tableData:[],dialogAddFormVisible:!1,dialogAddRoleFormVisible:!1,dialogMemberData:{},currentPage:1,size:10,total:0,roleData:{},addForm:{username:"",phone:"",password:""},roles:[]}},methods:{deleteRow(e,t){this.$confirm("此操作将永久删除该用户, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.deleteMember(t.id)})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},handleSelectionChange(e){this.deleteData=e},delSelection(){this.$confirm("此操作将永久删除该用户, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{if(0!=this.deleteData.length)for(let e=0;e<this.deleteData.length;e++)this.deleteMember(this.deleteData[e].id);this.$message({type:"success",message:"删除成功!"}),setTimeout((()=>{this.getAllMember()}),500)})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},openAddMember(){Object.assign(this.addForm,{username:"",phone:"",password:""}),this.dialogAddFormVisible=!0},addMember(e){this.$refs[e].validate((e=>{if(!e)return this.$message({type:"warning",message:"请检查您的输入是否正确!"}),!1;this.addMemberer(this.addForm),this.dialogAddFormVisible=!1}))},openAlterMember(e,t){this.roles=[],this.dialogMemberData=t;for(let a=0;a<t.roles.length;a++)this.roles.push(t.roles[a].realname);this.dialogAddRoleFormVisible=!0},addRole(){let e=[];this.roles.forEach((t=>{let a=this.roleData.filter((function(e){return e.realname===t}));e.push(...a)})),console.log(this.dialogMemberData.id),this.updateUserRole(e,this.dialogMemberData.id),this.dialogAddRoleFormVisible=!1},async getAllMember(e=1){this.currentPage=e;let t=await this.$http.reqGetAllMember(this.currentPage,this.size);0==t.code?(console.log("获得所有用户",t),this.tableData=t.data.records):this.$message.error(t.msg)},async addMemberer(e){let t=await this.$http.reqAddMemberer(e);console.log("添加用户人员",t),0==t.code?(this.$message({type:"success",message:"添加用户成功!"}),this.getAllMember()):this.$message.error(t.msg)},async getAllRoles(){let e=await this.$http.reqGetAllRoles();0==e.code?(console.log("获得所有角色",e),this.roleData=e.data.filter((function(e){return"普通用户"!==e.realname}))):this.$message.error(e.msg)},async updateUserRole(e,t){let a=await this.$http.reqUpdateUserRole(e,t);0==a.code?(console.log("修改角色分配",a),this.$message({type:"success",message:"修改角色分配成功!"}),this.getAllMember()):this.$message.error(a.msg)},async deleteMember(e){let t=await this.$http.reqDeleteMember(e);0==t.code?console.log("删除用户人员",t):this.$message.error(t.msg)}},mounted(){this.getAllMember(),this.getAllRoles()},watch:{deleteData:{immediate:!0,handler(e,t){0!=e.length?this.disabled=!1:this.disabled=!0}}}}),o=r,i=a(1001),n=(0,i.Z)(o,l,s,!1,null,"337624f8",null),d=n.exports}}]);